<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Management Application</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <header>
        <h2>Welcome to my Task Management Application</h2>
    </header>

    <div class="MainContainer">
        <div class="nav__lists">
            <button type="button" onclick="showAddTaskForm()" class="nav__link active-link">Add</button>
            <button type="button" onclick="showEditText()" class="nav__link active-link">Edit</button>
            <button type="button" onclick="showViewTask()" class="nav__link active-link">View Task</button>
        </div>

        <div class="ContainerToView"></div>
    </div>

    <footer></footer>

    <script>
        let completedTasks = JSON.parse(localStorage.getItem('completedTasks')) || [];
        let pendingTasks = JSON.parse(localStorage.getItem('pendingTasks')) || [];

        function saveTasks() {
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            localStorage.setItem('pendingTasks', JSON.stringify(pendingTasks));
        }

        function showAddTaskForm() {
            const container = document.querySelector(".ContainerToView");
            container.innerHTML = "";

            const newDiv = document.createElement("div");
            newDiv.classList.add("task-form");

            const inputField = document.createElement("input");
            inputField.type = "text";
            inputField.placeholder = "Enter your task here";
            inputField.classList.add("task-input");

            const addButton = document.createElement("button");
            addButton.textContent = "Add Task";
            addButton.classList.add("add-task-button");

            const taskList = document.createElement("ul");
            taskList.classList.add("task-list");

            newDiv.appendChild(inputField);
            newDiv.appendChild(addButton);
            newDiv.appendChild(taskList);

            container.appendChild(newDiv);

            displayPendingTasks(taskList);

            addButton.addEventListener("click", function () {
                const taskText = inputField.value.trim();

                if (taskText !== "") {
                    const task = {
                        text: taskText,
                        isCompleted: false,
                    };

                    pendingTasks.push(task);
                    saveTasks();

                    const newTask = createTaskElement(task, taskList);
                    taskList.appendChild(newTask);

                    inputField.value = "";
                } else {
                    alert("Please enter a task before adding.");
                }
            });
        }

        function createTaskElement(task, taskList) {
            const newTask = document.createElement("li");
            newTask.textContent = task.text;

            const checkBox = document.createElement("input");
            checkBox.type = "checkbox";
            checkBox.classList.add("task-checkbox");

            const deleteButton = document.createElement("button");
            deleteButton.textContent = "Delete";
            deleteButton.classList.add("delete-button");

            newTask.appendChild(checkBox);
            newTask.appendChild(deleteButton);

            checkBox.addEventListener("change", function () {
                if (checkBox.checked) {
                    task.isCompleted = true;
                    completedTasks.push(task);
                    pendingTasks = pendingTasks.filter((t) => t !== task);
                    newTask.style.display = "none";
                } else {
                    task.isCompleted = false;
                    pendingTasks.push(task);
                    completedTasks = completedTasks.filter((t) => t !== task);
                    newTask.style.display = "block";
                }
                saveTasks();
            });

            deleteButton.addEventListener("click", function () {
                pendingTasks = pendingTasks.filter((t) => t !== task);
                taskList.removeChild(newTask);
                saveTasks();
            });

            return newTask;
        }

        function displayPendingTasks(taskList) {
            pendingTasks.forEach((task) => {
                const taskItem = createTaskElement(task, taskList);
                taskList.appendChild(taskItem);
            });
        }

        function showEditText() {
            const container = document.querySelector(".ContainerToView");
            container.innerHTML = "";

            const taskDisplayDiv = document.createElement("div");
            taskDisplayDiv.classList.add("task-display");

            const taskList = document.createElement("ul");
            taskList.classList.add("task-list");

            if (pendingTasks.length === 0 && completedTasks.length === 0) {
                taskDisplayDiv.innerHTML = "<p>No tasks available to edit.</p>";
            } else {
                const allTasks = [...pendingTasks, ...completedTasks];
                allTasks.forEach((task, index) => {
                    const taskItem = document.createElement("li");
                    taskItem.classList.add("task-item");

                    const taskText = document.createElement("span");
                    taskText.textContent = task.text;
                    taskText.classList.add("task-text");

                    const editButton = document.createElement("button");
                    editButton.textContent = "Edit";
                    editButton.classList.add("edit-button");

                    const deleteButton = document.createElement("button");
                    deleteButton.textContent = "Delete";
                    deleteButton.classList.add("delete-button");

                    taskItem.appendChild(taskText);
                    taskItem.appendChild(editButton);
                    taskItem.appendChild(deleteButton);
                    taskList.appendChild(taskItem);

                    editButton.addEventListener("click", () => {
                        showTaskEditForm(index, taskText);
                    });

                    deleteButton.addEventListener("click", () => {
                        if (task.isCompleted) {
                            completedTasks = completedTasks.filter((t) => t !== task);
                        } else {
                            pendingTasks = pendingTasks.filter((t) => t !== task);
                        }
                        taskList.removeChild(taskItem);
                        saveTasks();
                    });
                });
                taskDisplayDiv.appendChild(taskList);
            }
            container.appendChild(taskDisplayDiv);
        }

        function showTaskEditForm(taskIndex, currentText) {
            const container = document.querySelector(".ContainerToView");
            container.innerHTML = "";

            const editFormDiv = document.createElement("div");
            editFormDiv.classList.add("edit-form");

            const inputField = document.createElement("input");
            inputField.type = "text";
            inputField.value = currentText.textContent;
            inputField.classList.add("edit-input");

            const submitButton = document.createElement("button");
            submitButton.textContent = "Submit";
            submitButton.classList.add("submit-button");

            editFormDiv.appendChild(inputField);
            editFormDiv.appendChild(submitButton);

            container.appendChild(editFormDiv);

            submitButton.addEventListener("click", () => {
                const updatedText = inputField.value.trim();

                if (updatedText !== "") {
                    const allTasks = [...pendingTasks, ...completedTasks];
                    allTasks[taskIndex].text = updatedText;
                    saveTasks();
                    showEditText();
                } else {
                    alert("Task text cannot be empty.");
                }
            });
        }

        function showViewTask() {
            const container = document.querySelector(".ContainerToView");
            container.innerHTML = "";

            const taskDisplayDiv = document.createElement("div");
            taskDisplayDiv.classList.add("task-display");

            const taskList = document.createElement("ul");
            taskList.classList.add("task-list");

            const filterSelect = document.createElement("select");
            filterSelect.classList.add("filter-status");
            const allOption = document.createElement("option");
            allOption.value = "all";
            allOption.textContent = "All Tasks";
            const completedOption = document.createElement("option");
            completedOption.value = "completed";
            completedOption.textContent = "Completed";
            const pendingOption = document.createElement("option");
            pendingOption.value = "pending";
            pendingOption.textContent = "Pending";

            filterSelect.appendChild(allOption);
            filterSelect.appendChild(completedOption);
            filterSelect.appendChild(pendingOption);

            taskDisplayDiv.appendChild(filterSelect);

            filterSelect.addEventListener("change", (e) => {
                const filterValue = e.target.value;

                taskList.innerHTML = "";

                let filteredTasks;
                if (filterValue === "completed") {
                    filteredTasks = completedTasks;
                } else if (filterValue === "pending") {
                    filteredTasks = pendingTasks;
                } else {
                    filteredTasks = [...pendingTasks, ...completedTasks];
                }

                filteredTasks.forEach((task) => {
                    const taskItem = document.createElement("li");
                    taskItem.textContent = task.text;

                    const deleteButton = document.createElement("button");
                    deleteButton.textContent = "Delete";
                    deleteButton.classList.add("delete-button");

                    taskItem.appendChild(deleteButton);
                    taskList.appendChild(taskItem);

                    deleteButton.addEventListener("click", () => {
                        if (task.isCompleted) {
                            completedTasks = completedTasks.filter((t) => t !== task);
                        } else {
                            pendingTasks = pendingTasks.filter((t) => t !== task);
                        }
                        taskList.removeChild(taskItem);
                        saveTasks();
                    });
                });
            });
            taskDisplayDiv.appendChild(taskList);
            container.appendChild(taskDisplayDiv);
        }
    </script>
</body>
</html>